# Implementation Plan: Vendor Management System (Phase 7A)

**Branch**: `008-vendor-management` | **Date**: 2026-01-14 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/008-vendor-management/spec.md`

## Summary

Implement a comprehensive vendor management interface for wedding consultants to track vendors, contracts, and payments. Phase 7A covers vendor CRUD operations, card grid with search/filters, status badges, and vendor detail pages. Following established patterns from Phase 6B (Guest Management) for consistency.

## Technical Context

**Language/Version**: TypeScript 5.x with React 18+ (strict mode)
**Primary Dependencies**: React Router v6, TanStack Query v5, React Hook Form, Zod, Shadcn/ui, Tailwind CSS v3, date-fns, Lucide React
**Storage**: Supabase PostgreSQL (vendors table exists with RLS enabled)
**Testing**: Manual testing with Playwright MCP only (per constitution)
**Target Platform**: Web (desktop + mobile responsive)
**Project Type**: web
**Performance Goals**: Page load < 2s, search response < 500ms (including 300ms debounce)
**Constraints**: WCAG 2.1 AA compliance, < 1.2s FCP, < 3.5s TTI
**Scale/Scope**: 5-15 vendors per wedding typical, up to 50 max

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

**VowSync Constitutional Gates:**

| Principle | Gate | Status |
|-----------|------|--------|
| I. Technical Stack | Uses React 18+, Vite, Tailwind, Shadcn/ui, Supabase | [x] |
| II. Design System | Follows color palette, typography, spacing specs | [x] |
| III. Database | UUID PKs, RLS enabled, proper constraints | [x] |
| IV. Code Quality | TypeScript strict, functional components, proper naming | [x] |
| V. Accessibility | WCAG 2.1 AA compliance, contrast, keyboard nav | [x] |
| VI. Business Logic | Accurate calculations, proper validations | [x] |
| VII. Security | RLS, no API key exposure, input validation | [x] |
| VIII. Testing | Manual testing with Playwright MCP only | [x] |
| IX. Error Handling | Toast notifications, error boundaries, loading states | [x] |
| X. Performance | FCP < 1.2s, TTI < 3.5s, lazy loading | [x] |
| XI. API Handling | Standard response format, error pattern | [x] |
| XII. Git Workflow | Feature branches, descriptive commits | [x] |
| XIII. Documentation | JSDoc for complex functions, README complete | [x] |
| XIV. Environment | Uses .env, no secrets in git | [x] |
| XV. Prohibited | No violations of prohibited practices | [x] |

## Project Structure

### Documentation (this feature)

```text
specs/008-vendor-management/
├── plan.md              # This file
├── spec.md              # Feature specification
├── research.md          # Technology decisions
├── data-model.md        # Entity definitions
├── quickstart.md        # Setup instructions
├── contracts/           # API contracts
│   └── vendors-api.md   # Vendor CRUD endpoints
├── checklists/
│   └── requirements.md  # Quality validation
└── tasks.md             # Implementation tasks (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
src/
├── components/
│   ├── ui/                         # Shadcn components (existing)
│   └── vendors/                    # NEW: Feature-specific components
│       ├── VendorList.tsx          # Card grid with search/filters
│       ├── VendorCard.tsx          # Individual vendor card
│       ├── VendorModal.tsx         # 3-tab create/edit modal
│       ├── VendorBasicInfoTab.tsx  # Basic info form tab
│       ├── VendorContractTab.tsx   # Contract details form tab
│       ├── VendorBankingTab.tsx    # Banking info form tab
│       ├── ContractStatusBadge.tsx # Contract status indicator
│       ├── PaymentStatusBadge.tsx  # Payment status indicator
│       ├── DeleteVendorDialog.tsx  # Delete confirmation
│       ├── VendorOverviewTab.tsx   # Detail page overview tab
│       └── VendorContractTabView.tsx # Detail page contract tab
├── hooks/
│   ├── useVendors.ts               # NEW: Fetch all vendors
│   ├── useVendor.ts                # NEW: Fetch single vendor
│   └── useVendorMutations.ts       # NEW: CRUD mutations
├── pages/
│   └── vendors/                    # NEW: Vendor pages
│       ├── VendorsPage.tsx         # Vendor list page
│       └── VendorDetailPage.tsx    # Vendor detail page
├── types/
│   └── vendor.ts                   # NEW: Vendor type definitions
├── schemas/
│   └── vendor.ts                   # NEW: Zod validation schema
└── App.tsx                         # UPDATE: Add vendor routes
```

**Structure Decision**: Web application following established VowSync patterns. All new files in `src/` follow the existing organization: types in `types/`, schemas in `schemas/`, hooks in `hooks/`, components in `components/vendors/`, pages in `pages/vendors/`.

## Complexity Tracking

> No violations requiring justification. All patterns follow established Phase 6B conventions.

## Implementation Phases

### Phase 1: Types & Schemas
- Create `src/types/vendor.ts` with all interfaces
- Create `src/schemas/vendor.ts` with Zod validation
- Include status calculation functions

### Phase 2: Data Layer
- Create `src/hooks/useVendors.ts` (TanStack Query)
- Create `src/hooks/useVendor.ts` (single vendor)
- Create `src/hooks/useVendorMutations.ts` (CRUD)

### Phase 3: UI Components
- Create status badges (ContractStatusBadge, PaymentStatusBadge)
- Create VendorCard component
- Create VendorList with grid layout
- Create 3-tab VendorModal (Basic, Contract, Banking)
- Create DeleteVendorDialog

### Phase 4: Pages & Routing
- Create VendorsPage with header, search, filters
- Create VendorDetailPage with tabs
- Update App.tsx with new routes

### Phase 5: Integration & Polish
- Implement 300ms search debounce
- Add empty states
- Add loading states
- Add error handling with toasts
- Verify responsive design

## Key Technical Decisions

### Contract Status Calculation (FR-012)
```typescript
function calculateContractStatus(vendor: Vendor): ContractStatusBadge {
  if (!vendor.contract_signed) return { label: 'Unsigned', color: 'yellow' };
  if (!vendor.contract_expiry_date) return { label: 'Signed', color: 'green' };

  const daysUntilExpiry = differenceInDays(
    new Date(vendor.contract_expiry_date),
    new Date()
  );

  if (daysUntilExpiry < 0) return { label: 'Expired', color: 'red' };
  if (daysUntilExpiry <= 30) return { label: 'Expiring Soon', color: 'orange' };
  return { label: 'Signed', color: 'green' };
}
```

### Payment Status (Phase 7A Placeholder)
```typescript
function calculatePaymentStatus(): PaymentStatusBadge {
  return { label: 'Pending', color: 'blue' }; // Phase 7B implementation
}
```

### Form Conditional Fields (FR-008)
- Contract fields shown only when `contract_signed` is checked
- Insurance fields shown only when `insurance_required` is checked
- Use React Hook Form `watch()` for conditional rendering

### Grid Layout (FR-001)
```typescript
className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
```

### Modal Size
```typescript
className="max-w-3xl" // 768px for 3-tab layout
```

## Design System Compliance

### Colors (from constitution)
- Primary: `#D4A5A5` (Dusty Rose) - buttons, focus states
- Success: `#4CAF50` (green) - Signed badge
- Warning: `#FF9800` (yellow/orange) - Unsigned, Expiring Soon badges
- Error: `#F44336` (red) - Expired badge
- Info: `#2196F3` (blue) - Pending badge

### Component Styling
- Cards: `rounded-lg shadow-sm border p-6`
- Badges: `px-2 py-1 rounded-full text-xs font-medium`
- Modal: `max-w-3xl rounded-xl shadow-lg p-8`
- Inputs: `h-10 rounded-md border px-3`

## Dependencies

| Dependency | Purpose | Status |
|------------|---------|--------|
| @tanstack/react-query | Server state management | ✅ Installed |
| react-hook-form | Form handling | ✅ Installed |
| zod | Validation | ✅ Installed |
| date-fns | Date calculations | ✅ Installed |
| lucide-react | Icons | ✅ Installed |
| @/components/ui/* | Shadcn components | ✅ Available |

No new dependencies required.

## Database (Verified)

| Table | Status | RLS |
|-------|--------|-----|
| vendors | ✅ Exists | ✅ Enabled |
| vendor_contacts | ✅ Exists (Phase 7B) | ✅ Enabled |
| vendor_payment_schedule | ✅ Exists (Phase 7B) | ✅ Enabled |
| vendor_invoices | ✅ Exists (Phase 7B) | ✅ Enabled |

No migrations required for Phase 7A.

## Phase 7A Scope Summary

### In Scope
- [x] Vendor list page with card grid
- [x] Search with 300ms debounce
- [x] Filter by type, contract status, payment status
- [x] Create vendor (3-tab modal)
- [x] Edit vendor (pre-populated modal)
- [x] Delete vendor (confirmation dialog)
- [x] Contract status badge (full logic)
- [x] Payment status badge (placeholder)
- [x] Vendor detail page (Overview, Contract tabs)
- [x] Payments/Invoices tabs (placeholder messages)

### Out of Scope (Phase 7B)
- [ ] Payment schedule CRUD
- [ ] Invoice management CRUD
- [ ] Additional contacts CRUD
- [ ] Full payment status calculation
- [ ] Document upload for contracts

## Related Artifacts

- [spec.md](./spec.md) - Feature specification
- [research.md](./research.md) - Technology decisions
- [data-model.md](./data-model.md) - Entity definitions
- [quickstart.md](./quickstart.md) - Setup instructions
- [contracts/vendors-api.md](./contracts/vendors-api.md) - API contracts

## Next Step

Run `/speckit.tasks` to generate the implementation task list.
